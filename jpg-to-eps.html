<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free JPG to EPS Converter - Convert JPG to EPS format (EPS 10, EPS 9, EPS 8).">
    <link rel="icon" type="image/png" href="https://flexible-jade-j2fhsqcxkf.edgeone.app/icon.png">
    <title>JPG to EPS Converter - Free Online Tool | AIVOROPRO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="header-placeholder"></div>
    <div class="tool-container">
        <div class="tool-header">
            <h1>AI JPG to EPS Converter</h1>
            <p>Convert JPG images to EPS format (EPS 10, EPS 9, EPS 8).</p>
        </div>
        <div class="upload-area" id="uploadArea">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>Drag and drop your JPG image here</p>
            <span>or click to browse</span>
        </div>
        <div class="file-display-container">
            <div class="file-display-box">
                <h3>Original JPG</h3>
                <div class="file-preview" id="originalPreview">
                    <div class="file-preview-placeholder"><i class="fas fa-image"></i><p>Original JPG will appear here</p></div>
                </div>
            </div>
            <div class="file-display-box">
                <h3>Converted EPS</h3>
                <div class="file-preview" id="processedPreview">
                    <div class="file-preview-placeholder"><i class="fas fa-image"></i><p>Converted EPS will appear here</p></div>
                </div>
            </div>
        </div>
        <div class="text-center mt-4">
            <label class="me-3">EPS Version:</label>
            <select id="epsVersion" class="form-select d-inline-block" style="width: auto;">
                <option value="10">EPS 10</option>
                <option value="9" selected>EPS 9</option>
                <option value="8">EPS 8</option>
            </select>
            <button class="btn btn-primary ms-3" id="processBtn" disabled><i class="fas fa-magic"></i> Convert to EPS</button>
            <button class="btn btn-secondary ms-2" id="downloadBtn" disabled><i class="fas fa-download"></i> Download EPS</button>
        </div>
    </div>
    <div id="footer-placeholder"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="main.js"></script>
    <script>
        let currentFile = null, processedImageData = null, epsFileData = null;
        
        function createEPSFile(imageData, width, height, version) {
            // Get image data as base64
            const base64Data = imageData.split(',')[1];
            const binaryData = atob(base64Data);
            const bytes = new Uint8Array(binaryData.length);
            for (let i = 0; i < binaryData.length; i++) {
                bytes[i] = binaryData.charCodeAt(i);
            }
            
            // Calculate points (EPS uses points, 72 points = 1 inch)
            // Standard DPI is 72 for EPS files
            const widthPt = width;
            const heightPt = height;
            
            // Get current date in proper format for EPS
            const now = new Date();
            const dateStr = now.toISOString().replace(/T/, ' ').replace(/\..+/, '');
            
            // Create proper EPS header following Adobe Illustrator EPS specifications
            // Must follow Adobe EPSF (Encapsulated PostScript Format) specification
            const epsHeader = `%!PS-Adobe-${version}.0 EPSF-${version}.0
%%Creator: Adobe Illustrator(R) ${version}.0
%%Title: (Converted Image)
%%CreationDate: (${dateStr})
%%BoundingBox: 0 0 ${Math.ceil(widthPt)} ${Math.ceil(heightPt)}
%%HiResBoundingBox: 0.0 0.0 ${widthPt.toFixed(2)} ${heightPt.toFixed(2)}
%%DocumentProcessColors: Cyan Magenta Yellow Black
%%DocumentSuppliedResources: ProcSet Adobe_Illustrator_AI_${version}_EPS
%%ColorUsage: Color
%%DocumentMedia: Default ${Math.ceil(widthPt)} ${Math.ceil(heightPt)} 0 () ()
%%LanguageLevel: ${version}
%%Pages: 1
%%PageOrder: Ascend
%%Orientation: Portrait
%%DocumentNeededResources: ProcSet Adobe_Illustrator_AI_${version}_EPS
%%DocumentData: Clean7Bit
%%EndComments
%%BeginDefaults
%%EndDefaults
%%BeginProlog
%%BeginResource: procset Adobe_Illustrator_AI_${version}_EPS 1.0 0
%%Title: (Adobe Illustrator(R) ${version}.0)
%%Version: ${version}.0
%%EndResource
%%EndProlog
%%BeginSetup
%%EndSetup
%%Page: 1 1
%%PageBoundingBox: 0 0 ${Math.ceil(widthPt)} ${Math.ceil(heightPt)}
%%BeginPageSetup
%%PageBoundingBox: 0 0 ${Math.ceil(widthPt)} ${Math.ceil(heightPt)}
%%EndPageSetup
gsave
0 0 ${widthPt} ${heightPt} rectclip
`;
            
            // Convert image data to hex encoding (PostScript standard)
            // Each line should be max 80 characters for PostScript compatibility
            const hexData = Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');
            
            // Split into lines of 80 characters (PostScript standard line length)
            const lines = [];
            for (let i = 0; i < hexData.length; i += 80) {
                lines.push(hexData.substring(i, Math.min(i + 80, hexData.length)));
            }
            
            // Create image data section with proper PostScript image operator
            // PostScript colorimage syntax: width height bits/sample matrix datasource ncomp colorimage
            // For RGB: width height 8 [matrix] datasource 3 colorimage
            // Matrix format: [a b c d tx ty] where a=width, d=height, others=0
            const imageDataSection = `${Math.floor(widthPt)} ${Math.floor(heightPt)} 8
[${Math.floor(widthPt)} 0 0 ${Math.floor(heightPt)} 0 0]
{<
${lines.join('\n')}
>}
false 3 colorimage
`;
            
            // Create proper EPS footer following Adobe Illustrator standards
            const epsFooter = `grestore
%%Trailer
%%Pages: 1
%%EOF`;
            
            return epsHeader + imageDataSection + epsFooter;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeFileUpload('uploadArea', 'originalPreview', 'processedPreview', function(file) { currentFile = file; document.getElementById('processBtn').disabled = false; }, 'image');
            
            // Ensure upload area is clickable (backup handler - only if main.js handler didn't work)
            setTimeout(function() {
                const uploadArea = document.getElementById('uploadArea');
                if (uploadArea) {
                    uploadArea.style.cursor = 'pointer';
                    uploadArea.setAttribute('role', 'button');
                    uploadArea.setAttribute('tabindex', '0');
                    uploadArea.addEventListener('click', function(e) {
                        // Only fire if event wasn't already handled by main.js
                        if (!e.defaultPrevented && e.target.tagName !== 'BUTTON' && e.target.tagName !== 'A' && 
                            e.target.tagName !== 'INPUT' && !e.target.closest('button') && !e.target.closest('a')) {
                            const fileInput = uploadArea.querySelector('input[type="file"]');
                            if (fileInput) {
                                e.stopImmediatePropagation();
                                try {
                                    fileInput.click();
                                } catch (err) {
                                    setTimeout(function() { fileInput.click(); }, 10);
                                }
                            }
                        }
                    }, false); // Use bubble phase, fires after capture phase
                }
            }, 100);
            
            document.getElementById('processBtn').addEventListener('click', function() {
                if (currentFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            const canvas = document.createElement('canvas');
                            canvas.width = img.width; canvas.height = img.height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0);
                            processedImageData = canvas.toDataURL('image/png');
                            const version = document.getElementById('epsVersion').value;
                            epsFileData = createEPSFile(processedImageData, img.width, img.height, version);
                            document.getElementById('processedPreview').innerHTML = `<img src="${processedImageData}" alt="EPS Preview" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                            document.getElementById('downloadBtn').disabled = false;
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(currentFile);
                }
            });
            document.getElementById('downloadBtn').addEventListener('click', function() {
                if (epsFileData && currentFile) {
                    const blob = new Blob([epsFileData], { type: 'application/postscript' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = currentFile.name.replace(/\.[^/.]+$/, '') + '.eps';
                    link.click();
                    URL.revokeObjectURL(url);
                }
            });
        });
    </script>
</body>
</html>

