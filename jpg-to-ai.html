<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free JPG to AI Converter - Convert JPG images to Adobe Illustrator AI format.">
    <link rel="icon" type="image/png" href="https://flexible-jade-j2fhsqcxkf.edgeone.app/icon.png">
    <title>JPG to AI Converter - Free Online Tool | AIVOROPRO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="header-placeholder"></div>
    <div class="tool-container">
        <div class="tool-header">
            <h1>AI JPG to AI Converter</h1>
            <p>Convert JPG images to Adobe Illustrator AI format.</p>
        </div>
        <div class="upload-area" id="uploadArea">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>Drag and drop your JPG image here</p>
            <span>or click to browse</span>
        </div>
        <div class="file-display-container">
            <div class="file-display-box">
                <h3>Original JPG</h3>
                <div class="file-preview" id="originalPreview">
                    <div class="file-preview-placeholder"><i class="fas fa-image"></i><p>Original JPG will appear here</p></div>
                </div>
            </div>
            <div class="file-display-box">
                <h3>Converted AI</h3>
                <div class="file-preview" id="processedPreview">
                    <div class="file-preview-placeholder"><i class="fas fa-image"></i><p>Converted AI will appear here</p></div>
                </div>
            </div>
        </div>
        <div class="text-center mt-4">
            <button class="btn btn-primary" id="processBtn" disabled><i class="fas fa-magic"></i> Convert to AI</button>
            <button class="btn btn-secondary ms-2" id="downloadBtn" disabled><i class="fas fa-download"></i> Download AI</button>
        </div>
    </div>
    <div id="footer-placeholder"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="main.js"></script>
    <script>
        let currentFile = null, processedImageData = null, aiFileData = null;
        
        function createAIFile(imageData, width, height) {
            // Adobe Illustrator AI files are PDF-based with special structure
            // Following Adobe Illustrator AI format specification (PDF 1.4+)
            // Must follow all Adobe Illustrator rules for compatibility
            
            const base64Data = imageData.split(',')[1];
            const binaryData = atob(base64Data);
            const bytes = new Uint8Array(binaryData.length);
            for (let i = 0; i < binaryData.length; i++) {
                bytes[i] = binaryData.charCodeAt(i);
            }
            
            // Calculate points (72 points = 1 inch, standard for Illustrator)
            const widthPt = width;
            const heightPt = height;
            
            const parts = [];
            let offset = 0;
            
            // PDF Header - Adobe Illustrator AI files start with PDF 1.4 header
            // Must include binary comment for proper PDF structure
            parts.push({ type: 'string', data: '%PDF-1.4\n%âãÏÓ\n\n', offset: offset });
            offset += parts[parts.length - 1].data.length;
            
            // Catalog object (Root) - Required for PDF structure
            // Must include proper PDF catalog structure for Illustrator compatibility
            const catalogObj = '1 0 obj\n<<\n/Type /Catalog\n/Pages 2 0 R\n/PageMode /UseNone\n/ViewerPreferences <<\n/HideToolbar true\n/HideMenubar true\n/HideWindowUI true\n/FitWindow true\n>>\n>>\nendobj\n\n';
            parts.push({ type: 'string', data: catalogObj, offset: offset });
            offset += parts[parts.length - 1].data.length;
            
            // Pages object - Required for PDF page structure
            const pagesObj = '2 0 obj\n<<\n/Type /Pages\n/Kids [3 0 R]\n/Count 1\n>>\nendobj\n\n';
            parts.push({ type: 'string', data: pagesObj, offset: offset });
            offset += parts[parts.length - 1].data.length;
            
            // Page object with proper MediaBox and all required boxes
            // Following Adobe Illustrator AI format requirements
            const pageObj = `3 0 obj\n<<\n/Type /Page\n/Parent 2 0 R\n/MediaBox [0 0 ${widthPt} ${heightPt}]\n/CropBox [0 0 ${widthPt} ${heightPt}]\n/BleedBox [0 0 ${widthPt} ${heightPt}]\n/TrimBox [0 0 ${widthPt} ${heightPt}]\n/ArtBox [0 0 ${widthPt} ${heightPt}]\n/Resources <<\n/XObject <<\n/Im1 4 0 R\n>>\n/ProcSet [/PDF /ImageC]\n>>\n/Contents 5 0 R\n/Rotate 0\n>>\nendobj\n\n`;
            parts.push({ type: 'string', data: pageObj, offset: offset });
            offset += parts[parts.length - 1].data.length;
            
            // Image XObject - using JPEG DCT encoding (standard for AI files)
            // Must follow PDF XObject specification
            const imageObjHeader = `4 0 obj\n<<\n/Type /XObject\n/Subtype /Image\n/Width ${width}\n/Height ${height}\n/ColorSpace /DeviceRGB\n/BitsPerComponent 8\n/Filter /DCTDecode\n/Length ${bytes.length}\n/Name /Im1\n>>\nstream\n`;
            parts.push({ type: 'string', data: imageObjHeader, offset: offset });
            const imageObjHeaderOffset = offset;
            offset += imageObjHeader.length;
            
            // Image data bytes (JPEG encoded)
            parts.push({ type: 'bytes', data: bytes, offset: offset });
            const imageDataOffset = offset;
            offset += bytes.length;
            
            // Image stream end
            parts.push({ type: 'string', data: '\nendstream\nendobj\n\n', offset: offset });
            offset += parts[parts.length - 1].data.length;
            
            // Content stream - draws the image using PDF graphics operators
            // Following Adobe Illustrator content stream format
            const contentStreamData = `q\n${widthPt} 0 0 ${heightPt} 0 0 cm\n/Im1 Do\nQ\n`;
            const contentStream = `5 0 obj\n<<\n/Length ${contentStreamData.length}\n>>\nstream\n${contentStreamData}endstream\nendobj\n\n`;
            parts.push({ type: 'string', data: contentStream, offset: offset });
            offset += parts[parts.length - 1].data.length;
            
            // Calculate xref table offsets correctly
            // XRef table is critical for PDF structure - must be accurate
            const xrefOffset = offset;
            const obj1Offset = 0; // PDF header starts at 0
            const obj2Offset = parts[1].offset;
            const obj3Offset = parts[2].offset;
            const obj4Offset = parts[3].offset;
            const obj5Offset = parts[5].offset;
            
            // XRef table - must be accurate for PDF structure
            // Format: offset generation_number n/f (n=in use, f=free)
            // First entry is always free object (0 65535 f)
            const xref = `xref\n0 6\n0000000000 65535 f \n${String(obj1Offset).padStart(10, '0')} 00000 n \n${String(obj2Offset).padStart(10, '0')} 00000 n \n${String(obj3Offset).padStart(10, '0')} 00000 n \n${String(obj4Offset).padStart(10, '0')} 00000 n \n${String(obj5Offset).padStart(10, '0')} 00000 n \n`;
            parts.push({ type: 'string', data: xref, offset: offset });
            offset += xref.length;
            
            // Trailer - following Adobe Illustrator AI format
            // Must include proper PDF trailer structure
            const trailer = `trailer\n<<\n/Size 6\n/Root 1 0 R\n/Info <<\n/Creator (Adobe Illustrator)\n/Producer (AIVOROPRO JPG to AI Converter)\n>>\n>>\nstartxref\n${xrefOffset}\n%%EOF`;
            parts.push({ type: 'string', data: trailer, offset: offset });
            
            // Calculate total length
            const totalLength = offset + trailer.length;
            const result = new Uint8Array(totalLength);
            
            // Build the file byte by byte
            parts.forEach(part => {
                if (part.type === 'string') {
                    for (let i = 0; i < part.data.length; i++) {
                        result[part.offset + i] = part.data.charCodeAt(i);
                    }
                } else if (part.type === 'bytes') {
                    for (let i = 0; i < part.data.length; i++) {
                        result[part.offset + i] = part.data[i];
                    }
                }
            });
            
            return result;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeFileUpload('uploadArea', 'originalPreview', 'processedPreview', function(file) { currentFile = file; document.getElementById('processBtn').disabled = false; }, 'image');
            
            // Ensure upload area is clickable (backup handler - only if main.js handler didn't work)
            setTimeout(function() {
                const uploadArea = document.getElementById('uploadArea');
                if (uploadArea) {
                    uploadArea.style.cursor = 'pointer';
                    uploadArea.setAttribute('role', 'button');
                    uploadArea.setAttribute('tabindex', '0');
                    uploadArea.addEventListener('click', function(e) {
                        // Only fire if event wasn't already handled by main.js
                        if (!e.defaultPrevented && e.target.tagName !== 'BUTTON' && e.target.tagName !== 'A' && 
                            e.target.tagName !== 'INPUT' && !e.target.closest('button') && !e.target.closest('a')) {
                            const fileInput = uploadArea.querySelector('input[type="file"]');
                            if (fileInput) {
                                e.stopImmediatePropagation();
                                try {
                                    fileInput.click();
                                } catch (err) {
                                    setTimeout(function() { fileInput.click(); }, 10);
                                }
                            }
                        }
                    }, false); // Use bubble phase, fires after capture phase
                }
            }, 100);
            
            document.getElementById('processBtn').addEventListener('click', function() {
                if (currentFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            const canvas = document.createElement('canvas');
                            canvas.width = img.width; canvas.height = img.height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0);
                            processedImageData = canvas.toDataURL('image/jpeg', 0.95);
                            aiFileData = createAIFile(processedImageData, img.width, img.height);
                            document.getElementById('processedPreview').innerHTML = `<img src="${processedImageData}" alt="AI Preview" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                            document.getElementById('downloadBtn').disabled = false;
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(currentFile);
                }
            });
            document.getElementById('downloadBtn').addEventListener('click', function() {
                if (aiFileData && currentFile) {
                    const blob = new Blob([aiFileData], { type: 'application/illustrator' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = currentFile.name.replace(/\.[^/.]+$/, '') + '.ai';
                    link.click();
                    URL.revokeObjectURL(url);
                }
            });
        });
    </script>
</body>
</html>

