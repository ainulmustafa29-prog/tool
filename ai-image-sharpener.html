<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free AI Image Sharpener - Sharpen blurry images using advanced AI algorithms.">
    <link rel="icon" type="image/png" href="https://flexible-jade-j2fhsqcxkf.edgeone.app/icon.png">
    <title>AI Image Sharpener - Free Online Tool | AIVOROPRO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="header-placeholder"></div>
    <div class="tool-container">
        <div class="tool-header">
            <h1>AI Image Sharpener</h1>
            <p>Sharpen blurry images using advanced AI algorithms.</p>
        </div>
        <div class="upload-area" id="uploadArea">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>Drag and drop your image here</p>
            <span>or click to browse</span>
        </div>
        <div class="file-display-container">
            <div class="file-display-box">
                <h3>Original Image</h3>
                <div class="file-preview" id="originalPreview">
                    <div class="file-preview-placeholder"><i class="fas fa-image"></i><p>Original image will appear here</p></div>
                </div>
            </div>
            <div class="file-display-box">
                <h3>Sharpened Image</h3>
                <div class="file-preview" id="processedPreview">
                    <div class="file-preview-placeholder"><i class="fas fa-image"></i><p>Sharpened image will appear here</p></div>
                </div>
            </div>
        </div>
        <div class="text-center mt-4">
            <button class="btn btn-primary" id="processBtn" disabled><i class="fas fa-magic"></i> Sharpen Image</button>
            <button class="btn btn-secondary ms-2" id="downloadBtn" disabled><i class="fas fa-download"></i> Download</button>
        </div>
    </div>
    <div id="footer-placeholder"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="main.js"></script>
    <script>
        let currentFile = null, processedImageData = null;
        document.addEventListener('DOMContentLoaded', function() {
            initializeFileUpload('uploadArea', 'originalPreview', 'processedPreview', function(file) { currentFile = file; document.getElementById('processBtn').disabled = false; }, 'image');
            
            // Ensure upload area is clickable (backup handler - only if main.js handler didn't work)
            setTimeout(function() {
                const uploadArea = document.getElementById('uploadArea');
                if (uploadArea) {
                    uploadArea.style.cursor = 'pointer';
                    uploadArea.setAttribute('role', 'button');
                    uploadArea.setAttribute('tabindex', '0');
                    uploadArea.addEventListener('click', function(e) {
                        // Only fire if event wasn't already handled by main.js
                        if (!e.defaultPrevented && e.target.tagName !== 'BUTTON' && e.target.tagName !== 'A' && 
                            e.target.tagName !== 'INPUT' && !e.target.closest('button') && !e.target.closest('a')) {
                            const fileInput = uploadArea.querySelector('input[type="file"]');
                            if (fileInput) {
                                e.stopImmediatePropagation();
                                try {
                                    fileInput.click();
                                } catch (err) {
                                    setTimeout(function() { fileInput.click(); }, 10);
                                }
                            }
                        }
                    }, false); // Use bubble phase, fires after capture phase
                }
            }, 100);
            
            document.getElementById('processBtn').addEventListener('click', function() {
                if (currentFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            const canvas = document.createElement('canvas');
                            canvas.width = img.width; canvas.height = img.height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0);
                            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                            const sharpenKernel = [0, -1, 0, -1, 5, -1, 0, -1, 0];
                            const data = imageData.data;
                            const width = canvas.width, height = canvas.height;
                            const output = new Uint8ClampedArray(data);
                            for (let y = 1; y < height - 1; y++) {
                                for (let x = 1; x < width - 1; x++) {
                                    for (let c = 0; c < 3; c++) {
                                        let sum = 0;
                                        for (let ky = -1; ky <= 1; ky++) {
                                            for (let kx = -1; kx <= 1; kx++) {
                                                const idx = ((y + ky) * width + (x + kx)) * 4 + c;
                                                sum += data[idx] * sharpenKernel[(ky + 1) * 3 + (kx + 1)];
                                            }
                                        }
                                        const idx = (y * width + x) * 4 + c;
                                        output[idx] = Math.max(0, Math.min(255, sum));
                                    }
                                }
                            }
                            ctx.putImageData(new ImageData(output, width, height), 0, 0);
                            processedImageData = canvas.toDataURL('image/png');
                            document.getElementById('processedPreview').innerHTML = `<img src="${processedImageData}" alt="Sharpened" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                            document.getElementById('downloadBtn').disabled = false;
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(currentFile);
                }
            });
            document.getElementById('downloadBtn').addEventListener('click', function() {
                if (processedImageData) { const link = document.createElement('a'); link.href = processedImageData; link.download = 'sharpened-image.png'; link.click(); }
            });
        });
    </script>
</body>
</html>

