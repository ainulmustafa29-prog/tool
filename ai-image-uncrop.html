<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free AI Image Uncrop Tool - Intelligently uncrop images to various aspect ratios (1:1, 9:16, 16:9, 4:3, Custom).">
    <link rel="icon" type="image/png" href="https://flexible-jade-j2fhsqcxkf.edgeone.app/icon.png">
    <title>AI Image Uncrop - Free Online Image Uncrop Tool | AIVOROPRO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="header-placeholder"></div>
    <div class="tool-container">
        <div class="tool-header">
            <h1>AI Image Uncrop</h1>
            <p>Intelligently uncrop images to various aspect ratios using AI technology.</p>
        </div>
        <div class="upload-area" id="uploadArea">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>Drag and drop your image here</p>
            <span>or click to browse</span>
        </div>
        <div class="file-display-container">
            <div class="file-display-box">
                <h3>Original Image</h3>
                <div class="file-preview white-bg" id="originalPreview">
                    <div class="file-preview-placeholder"><i class="fas fa-image"></i><p>Original image will appear here</p></div>
                </div>
            </div>
            <div class="file-display-box">
                <h3>Uncropped Image</h3>
                <div class="file-preview" id="processedPreview">
                    <div class="file-preview-placeholder"><i class="fas fa-image"></i><p>Uncropped image will appear here</p></div>
                </div>
            </div>
        </div>
        <div class="text-center mt-4">
            <label class="me-3">Aspect Ratio:</label>
            <select id="aspectRatio" class="form-select d-inline-block" style="width: auto;">
                <option value="1:1">1:1 (Square)</option>
                <option value="9:16">9:16 (Portrait)</option>
                <option value="16:9" selected>16:9 (Landscape)</option>
                <option value="4:3">4:3 (Standard)</option>
                <option value="custom">Custom</option>
            </select>
            <div id="customDimensions" class="mt-3" style="display: none;">
                <label class="me-2">Width:</label>
                <input type="number" id="customWidth" class="form-control d-inline-block" style="width: 100px;" placeholder="Width" min="1">
                <label class="ms-3 me-2">Height:</label>
                <input type="number" id="customHeight" class="form-control d-inline-block" style="width: 100px;" placeholder="Height" min="1">
            </div>
            <div class="mt-3">
                <button class="btn btn-primary" id="processBtn" disabled><i class="fas fa-magic"></i> Uncrop Image</button>
                <button class="btn btn-secondary ms-2" id="downloadBtn" disabled><i class="fas fa-download"></i> Download</button>
            </div>
        </div>
    </div>
    <div id="footer-placeholder"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="main.js"></script>
    <script>
        let currentFile = null, processedImageData = null, originalImage = null;
        document.addEventListener('DOMContentLoaded', function() {
            initializeFileUpload('uploadArea', 'originalPreview', 'processedPreview', function(file) { 
                currentFile = file; 
                document.getElementById('processBtn').disabled = false;
                
                // Load image to get dimensions
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        originalImage = img;
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }, 'image');
            
            // Ensure upload area is clickable (backup handler - only if main.js handler didn't work)
            setTimeout(function() {
                const uploadArea = document.getElementById('uploadArea');
                if (uploadArea) {
                    uploadArea.style.cursor = 'pointer';
                    uploadArea.setAttribute('role', 'button');
                    uploadArea.setAttribute('tabindex', '0');
                    uploadArea.addEventListener('click', function(e) {
                        // Only fire if event wasn't already handled by main.js
                        if (!e.defaultPrevented && e.target.tagName !== 'BUTTON' && e.target.tagName !== 'A' && 
                            e.target.tagName !== 'INPUT' && !e.target.closest('button') && !e.target.closest('a')) {
                            const fileInput = uploadArea.querySelector('input[type="file"]');
                            if (fileInput) {
                                e.stopImmediatePropagation();
                                try {
                                    fileInput.click();
                                } catch (err) {
                                    setTimeout(function() { fileInput.click(); }, 10);
                                }
                            }
                        }
                    }, false); // Use bubble phase, fires after capture phase
                }
            }, 100);
            
            // Handle aspect ratio change
            document.getElementById('aspectRatio').addEventListener('change', function() {
                const customDimensions = document.getElementById('customDimensions');
                if (this.value === 'custom') {
                    customDimensions.style.display = 'block';
                } else {
                    customDimensions.style.display = 'none';
                }
            });
            
            document.getElementById('processBtn').addEventListener('click', function() {
                if (currentFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            // Store original image reference
                            originalImage = img;
                            
                            const canvas = document.createElement('canvas');
                            const ratio = document.getElementById('aspectRatio').value;
                            let w = img.width, h = img.height;
                            
                            // Calculate crop dimensions based on aspect ratio
                            // Crop the image to match target ratio (remove from left/right or top/bottom)
                            let targetRatio;
                            
                            if (ratio === '1:1') { 
                                // Square: use the smaller dimension
                                targetRatio = 1;
                            } else if (ratio === '9:16') { 
                                // Portrait: width/height = 9/16
                                targetRatio = 9/16;
                            } else if (ratio === '16:9') { 
                                // Landscape: width/height = 16/9
                                targetRatio = 16/9;
                            } else if (ratio === '4:3') { 
                                // Standard: width/height = 4/3
                                targetRatio = 4/3;
                            } else if (ratio === 'custom') {
                                const customWidth = parseInt(document.getElementById('customWidth').value);
                                const customHeight = parseInt(document.getElementById('customHeight').value);
                                if (!customWidth || !customHeight || customWidth < 1 || customHeight < 1) {
                                    alert('Please enter valid custom width and height values.');
                                    return;
                                }
                                targetRatio = customWidth / customHeight;
                            }
                            
                            // Calculate crop dimensions to match target ratio
                            let cropWidth, cropHeight, cropX, cropY;
                            
                            if (ratio === '1:1') {
                                // Square: crop to square using smaller dimension
                                const size = Math.min(img.width, img.height);
                                cropWidth = cropHeight = size;
                                cropX = (img.width - size) / 2;
                                cropY = (img.height - size) / 2;
                            } else {
                                // Calculate what the crop dimensions should be
                                const currentRatio = img.width / img.height;
                                
                                if (currentRatio > targetRatio) {
                                    // Image is wider than target - crop from left and right
                                    cropHeight = img.height;
                                    cropWidth = cropHeight * targetRatio;
                                    cropX = (img.width - cropWidth) / 2;
                                    cropY = 0;
                                } else {
                                    // Image is taller than target - crop from top and bottom
                                    cropWidth = img.width;
                                    cropHeight = cropWidth / targetRatio;
                                    cropX = 0;
                                    cropY = (img.height - cropHeight) / 2;
                                }
                            }
                            
                            // Set canvas to cropped dimensions
                            w = cropWidth;
                            h = cropHeight;
                            
                            canvas.width = w;
                            canvas.height = h;
                            const ctx = canvas.getContext('2d');
                            
                            // Clear canvas with transparent background
                            ctx.clearRect(0, 0, w, h);
                            
                            // Draw the cropped portion of the image
                            ctx.drawImage(img, cropX, cropY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);
                            
                            processedImageData = canvas.toDataURL('image/png');
                            
                            // Add transparent background class and display image with size info
                            const processedPreview = document.getElementById('processedPreview');
                            processedPreview.classList.add('transparent-bg');
                            processedPreview.innerHTML = `
                                <div>
                                    <img src="${processedImageData}" alt="Uncropped" style="max-width: 100%; max-height: 100%; object-fit: contain; display: block;">
                                </div>
                            `;
                            
                            
                            document.getElementById('downloadBtn').disabled = false;
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(currentFile);
                }
            });
            
            document.getElementById('downloadBtn').addEventListener('click', function() {
                if (processedImageData) { 
                    const link = document.createElement('a'); 
                    link.href = processedImageData; 
                    link.download = 'uncropped-image.png'; 
                    link.click(); 
                }
            });
        });
    </script>
</body>
</html>

